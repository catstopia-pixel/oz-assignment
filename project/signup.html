<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <title>회원가입</title>

  <style>
    body.dark { background:#121212; color:#e9ecef; }
    body.dark .card { background:#1b1f23; color:#e9ecef; border-color:#2b3036; }
    body.dark .form-control { background:#1b1f23; color:#e9ecef; border-color:#3a3f45; }
  </style>
</head>

<body>
  <div class="container py-5" style="max-width: 720px;">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h1 class="h3 m-0">회원가입</h1>

      <div class="form-check form-switch m-0">
        <input class="form-check-input" type="checkbox" id="darkModeToggle">
        <label class="form-check-label" for="darkModeToggle">다크모드</label>
      </div>
    </div>

    <div class="card shadow-sm">
      <div class="card-body p-4">
        <form id="signupForm" novalidate>
          <!-- 아이디 -->
          <div class="mb-3">
            <label class="form-label" for="userId">아이디</label>
            <input class="form-control" id="userId" placeholder="4~20자 (영문/숫자/_)" required />
            <div class="invalid-feedback" id="userIdFeedback"></div>
          </div>

          <!-- 비밀번호 -->
          <div class="mb-3">
            <label class="form-label" for="password">비밀번호</label>
            <input type="password" class="form-control" id="password" placeholder="8자 이상, 영문+숫자" required />
            <div class="invalid-feedback" id="passwordFeedback"></div>
          </div>

          <!-- 비밀번호 확인 -->
          <div class="mb-3">
            <label class="form-label" for="passwordCheck">비밀번호 확인</label>
            <input type="password" class="form-control" id="passwordCheck" required />
            <div class="invalid-feedback" id="passwordCheckFeedback"></div>
          </div>

          <!-- 이메일 -->
          <div class="mb-4">
            <label class="form-label" for="email">이메일</label>
            <input type="email" class="form-control" id="email" placeholder="name@example.com" required />
            <div class="invalid-feedback" id="emailFeedback"></div>
          </div>

          <button type="submit" class="btn btn-primary w-100">회원가입 완료</button>

          <div class="mt-3 text-center">
            <a href="index.html" class="link-secondary">메인으로 돌아가기</a>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // 다크모드
    const darkToggle = document.getElementById("darkModeToggle");
    darkToggle.addEventListener("change", () => {
      document.body.classList.toggle("dark", darkToggle.checked);
    });

    // 폼 요소
    const form = document.getElementById("signupForm");
    const userId = document.getElementById("userId");
    const password = document.getElementById("password");
    const passwordCheck = document.getElementById("passwordCheck");
    const email = document.getElementById("email");

    const userIdFeedback = document.getElementById("userIdFeedback");
    const passwordFeedback = document.getElementById("passwordFeedback");
    const passwordCheckFeedback = document.getElementById("passwordCheckFeedback");
    const emailFeedback = document.getElementById("emailFeedback");

    function setValid(el) {
      el.classList.remove("is-invalid");
      el.classList.add("is-valid");
    }

    function setInvalid(el, fb, msg) {
      el.classList.remove("is-valid");
      el.classList.add("is-invalid");
      fb.textContent = msg;
    }

    function validateUserId() {
      const v = userId.value.trim();
      const re = /^[A-Za-z0-9_]{4,20}$/;
      if (!re.test(v)) {
        setInvalid(userId, userIdFeedback, "아이디는 4~20자, 영문/숫자/_(밑줄)만 가능합니다.");
        return false;
      }
      setValid(userId);
      return true;
    }

    function validatePassword() {
      const v = password.value;
      const re = /^(?=.*[A-Za-z])(?=.*\d).{8,}$/;
      if (!re.test(v)) {
        setInvalid(password, passwordFeedback, "비밀번호는 8자 이상이며 영문과 숫자를 포함해야 합니다.");
        return false;
      }
      setValid(password);
      return true;
    }

    function validatePasswordCheck() {
      const v = passwordCheck.value;
      if (v !== password.value || v.length === 0) {
        setInvalid(passwordCheck, passwordCheckFeedback, "비밀번호가 일치하지 않습니다.");
        return false;
      }
      setValid(passwordCheck);
      return true;
    }

    function validateEmail() {
      const v = email.value.trim();
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!re.test(v)) {
        setInvalid(email, emailFeedback, "이메일 형식이 올바르지 않습니다.");
        return false;
      }
      setValid(email);
      return true;
    }

    userId.addEventListener("input", validateUserId);
    password.addEventListener("input", () => {
      validatePassword();
      if (passwordCheck.value.length > 0) validatePasswordCheck();
    });
    passwordCheck.addEventListener("input", validatePasswordCheck);
    email.addEventListener("input", validateEmail);

    // 제출: 알림 + 페이지 전환
    form.addEventListener("submit", (e) => {
      e.preventDefault();

      const ok =
        validateUserId() &
        validatePassword() &
        validatePasswordCheck() &
        validateEmail();

      if (!ok) return;

      alert(
        `회원가입 완료!\n` +
        `아이디: ${userId.value.trim()}\n` +
        `이메일: ${email.value.trim()}`
      );

      const id = encodeURIComponent(userId.value.trim());
      const em = encodeURIComponent(email.value.trim());
      location.href = `success.html?id=${id}&email=${em}`;
    });
  </script>
</body>
</html>
